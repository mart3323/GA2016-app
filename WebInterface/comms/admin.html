<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title></title>
        <script src="extjs/jquery.js"></script>
        <script src="extjs/socket.io.js"></script>
        <script src="js/config.js"></script>
        <script src="js/External/RSA.js"></script>
        <script src="js/Physical layer/socketClient.js"></script>
        <script src="js/Application layer/ApplicationClient.js"></script>
        <script src="js/encryption.js"></script>
        <script>
            $(document).ready(function(){
                var client_encryption = new JSEncrypt();
                client_encryption.setPrivateKey(
                "-----BEGIN RSA PRIVATE KEY-----\
                MIIBOwIBAAJBAJgC6p1FA2OcaoI2kqg0pPZouWy3ehQ1KZNvhpzm+9hfQNynop1y\
                Mck1dQ4KPBMG67qvYuHitX/YB3/EMiR1c1UCAwEAAQJAbwmyVy8SSrD3HCbA+h16\
                YoQc7k0X36r1s7zDl9kiHepSPsM9ZFOJxT+YgKGk3Rn9EiP8iEdFoPXtKsfswj1g\
                AQIhAOkX7OtTE0dPGa7QV5qhxwRBQEYe2oHaGsBfUbZux2h9AiEApvMo8JOFV9z3\
                rfC5RmliVMHQO1PIIJvWh0tJSa/6hbkCIAZuMosLb6y38e1wsfoCHItxgWRt1Xlf\
                mv1To910kOvBAiEAjEniih58u3N8UZbqKafesDhZIbFqhzRM1k3GXPxauUkCIQDQ\
                lSMNQAIOItXMISpAAck5+e46rf0RGEPD8dQOqVn7Lg==\
                -----END RSA PRIVATE KEY-----"
                );
                client_encryption.setPublicKey(
                "-----BEGIN PUBLIC KEY-----\
                MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJgC6p1FA2OcaoI2kqg0pPZouWy3ehQ1\
                KZNvhpzm+9hfQNynop1yMck1dQ4KPBMG67qvYuHitX/YB3/EMiR1c1UCAwEAAQ==\
                -----END PUBLIC KEY-----"
                );
                connect_to_server("localhost",7332)
                .then(register_on_server(1,2)).then(function(){
                    console.log("Registered");
                });
                function connect_to_server(IP, PORT){
                    return new Promise(function(resolve, reject){
                        var socket = io(IP+":"+PORT);
                        console.log("client started");
                        socket.on("connect", function(){console.log("connected");resolve(socket);});
                        socket.on("reconnect", function(){console.log("connected");resolve(socket);});
                        socket.on("Challenge", function(){
                            console.log("Challenge received, register sent");
                            socket.emit("Register", {name:1, signature:2});
                        });
                    });
                }
                function register_on_server(private_key, public_key){
                    return function(socket){
                        return new Promise(function(resolve, reject){
                            socket.on("Registered",function(){
                                resolve(socket);
                            });
                        });
                    }
                }


            });
        </script>
    </head>
    <body>
        <span id="connected">connected</span>
        <div id="console"></div>

    </body>
</html>
